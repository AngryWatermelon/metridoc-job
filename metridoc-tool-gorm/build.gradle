project.ext.description = "Provides tool to use gorm in metridoc jobs and scripts"

def grailsVersion = "2.2.3"

dependencies {
    compile 'org.codehaus.groovy:groovy-all:2.0.8',
            "org.grails:grails-core:$grailsVersion",
            "org.grails:grails-spring:$grailsVersion",
            "org.grails:grails-web:$grailsVersion",
            "org.grails:grails-plugin-datasource:$grailsVersion"

    compile project(':metridoc-job-core')

    compile("org.grails:grails-plugin-domain-class:$grailsVersion") {
        exclude module: "persistence-api"
    }

    compile("org.grails:grails-hibernate:$grailsVersion") {
        exclude module: "persistence-api"
    }
}

enableMaven { pom ->

    pom.whenConfigured { pomToConfigure ->
        pomToConfigure.dependencies.each { dep ->
            def classLoader = dep.getClass().classLoader
            def Exclusion = classLoader.loadClass("org.apache.maven.model.Exclusion")
            def exclusionToAdd = Exclusion.newInstance(
                    artifactId: "persistence-api",
                    groupId: "javax.persistence"
            )


            dep.exclusions.add(exclusionToAdd)
        }
    }
}
